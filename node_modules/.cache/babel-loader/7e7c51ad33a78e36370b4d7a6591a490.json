{"ast":null,"code":"import { GET_CURRENT_USER, SET_CURRENT_USER, GET_ERRORS, API_URL } from '../constants/constants';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\nimport setHeader from '../../helpers/setHeader';\nimport { toast } from 'react-toastify';\nimport \"react-toastify/dist/ReactToastify.css\";\nimport { getCartInfo } from './CartActions';\nvar token = localStorage.getItem('token');\nvar headers = {\n  Authorization: \"Bearer \".concat(token)\n};\nexport var setCurrentUser = function setCurrentUser(user) {\n  return {\n    type: SET_CURRENT_USER,\n    payload: user\n  };\n};\nexport var getCurrentUser = function getCurrentUser() {\n  var token = localStorage.getItem('token');\n  setHeader(token);\n  var headers = {\n    Authorization: \"Bearer \".concat(token)\n  };\n  return function (dispatch) {\n    axios({\n      method: \"GET\",\n      headers: headers,\n      url: \"\".concat(API_URL, \"/api/auth/info\")\n    }).then(function (res) {\n      dispatch({\n        type: GET_CURRENT_USER,\n        payload: res.data\n      });\n    }).catch(function (err) {\n      console.log(err);\n    });\n  };\n};\nexport var getUserLogin = function getUserLogin() {\n  var token = localStorage.getItem('token');\n  setHeader(token);\n  var headers = {\n    Authorization: \"Bearer \".concat(token)\n  };\n  return axios({\n    method: \"GET\",\n    headers: headers,\n    url: \"\".concat(API_URL, \"/api/auth/info\")\n  });\n};\nexport var getErrors = function getErrors(errors) {\n  return {\n    type: GET_ERRORS,\n    payload: errors\n  };\n};\nexport var login = function login(user, history) {\n  var username = user.username,\n    password = user.password;\n  return function (dispatch) {\n    axios({\n      method: 'POST',\n      url: \"\".concat(API_URL, \"/api/auth/login\"),\n      data: {\n        username: username,\n        password: password\n      }\n    }).then(function (res) {\n      var token = res.data.token;\n      var username = res.data.username;\n      localStorage.setItem('token', token);\n      localStorage.setItem('username', username);\n      var decoded = jwtDecode(token);\n      dispatch(setCurrentUser(decoded));\n      dispatch(getCartInfo());\n      history.goBack();\n    }).catch(function (err) {\n      toast.error('Tài khoản hoặc mật khẩu không chính xác!', {\n        position: \"bottom-center\",\n        theme: 'dark',\n        autoClose: 2000,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n        progress: undefined\n      });\n      console.log(err);\n    });\n  };\n};\nexport var register = function register(data, history) {\n  return function (dispatch) {\n    axios({\n      method: \"POST\",\n      data: JSON.stringify(data),\n      url: \"\".concat(API_URL, \"/api/auth/register\"),\n      headers: {\n        'content-type': 'application/json'\n      }\n    }).then(function (res) {\n      toast.success(res.data.message, {\n        position: \"bottom-center\",\n        autoClose: 1500,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n        progress: undefined\n      });\n      history.push(\"/login\");\n    }).catch(function (err) {\n      if (err) {\n        toast.error(err.response.data.message, {\n          position: \"bottom-center\",\n          theme: 'dark',\n          autoClose: 2000,\n          hideProgressBar: false,\n          closeOnClick: true,\n          pauseOnHover: true,\n          draggable: true,\n          progress: undefined\n        });\n        dispatch(getErrors(err.response.data.message));\n      }\n    });\n  };\n};\nexport var updateInfo = function updateInfo(data) {\n  return axios({\n    method: \"PUT\",\n    url: \"\".concat(API_URL, \"/api/auth/update-info\"),\n    headers: headers,\n    data: data\n  });\n};\nexport var updatePassword = function updatePassword(data) {\n  return axios({\n    method: \"PUT\",\n    url: \"\".concat(API_URL, \"/api/auth/update-password\"),\n    headers: headers,\n    data: data\n  });\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"username\");\n    dispatch(setCurrentUser({}));\n    window.location.reload();\n    setHeader();\n  };\n};","map":{"version":3,"names":["GET_CURRENT_USER","SET_CURRENT_USER","GET_ERRORS","API_URL","axios","jwtDecode","setHeader","toast","getCartInfo","token","localStorage","getItem","headers","Authorization","concat","setCurrentUser","user","type","payload","getCurrentUser","dispatch","method","url","then","res","data","catch","err","console","log","getUserLogin","getErrors","errors","login","history","username","password","setItem","decoded","goBack","error","position","theme","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","register","JSON","stringify","success","message","push","response","updateInfo","updatePassword","logout","removeItem","window","location","reload"],"sources":["D:/TUTUSHOP/ecomerce-client/src/actions/services/UserActions.js"],"sourcesContent":["import {\r\n    GET_CURRENT_USER, SET_CURRENT_USER, GET_ERRORS, API_URL\r\n} from '../constants/constants'\r\n\r\nimport axios from 'axios'\r\nimport jwtDecode from 'jwt-decode'\r\nimport setHeader from '../../helpers/setHeader'\r\nimport { toast } from 'react-toastify'\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport { getCartInfo } from './CartActions'\r\nconst token = localStorage.getItem('token');\r\nconst headers = { Authorization: `Bearer ${token}` }\r\n\r\nexport const setCurrentUser = (user) => {\r\n    return {\r\n        type: SET_CURRENT_USER,\r\n        payload: user\r\n    }\r\n}\r\n\r\nexport const getCurrentUser = () => {\r\n    const token = localStorage.getItem('token');\r\n    setHeader(token);\r\n    const headers = { Authorization: `Bearer ${token}` }\r\n    return dispatch => {\r\n        axios({\r\n            method: \"GET\",\r\n            headers: headers,\r\n            url: `${API_URL}/api/auth/info`\r\n        })\r\n            .then((res) => {\r\n                dispatch({\r\n                    type: GET_CURRENT_USER,\r\n                    payload: res.data\r\n                });\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            })\r\n    }\r\n}\r\n\r\nexport const getUserLogin = () => {\r\n    const token = localStorage.getItem('token');\r\n    setHeader(token);\r\n    const headers = { Authorization: `Bearer ${token}` }\r\n    return axios({\r\n        method: \"GET\",\r\n        headers: headers,\r\n        url: `${API_URL}/api/auth/info`\r\n    })\r\n}\r\n\r\n\r\nexport const getErrors = (errors) => {\r\n    return {\r\n        type: GET_ERRORS,\r\n        payload: errors\r\n    }\r\n}\r\n\r\nexport const login = (user, history) => {\r\n    const { username, password } = user;\r\n    return dispatch => {\r\n        axios({\r\n            method: 'POST',\r\n            url: `${API_URL}/api/auth/login`,\r\n            data: { username, password }\r\n        })\r\n            .then((res) => {\r\n                const token = res.data.token;\r\n                const username = res.data.username;\r\n                localStorage.setItem('token', token);\r\n                localStorage.setItem('username', username);\r\n                const decoded = jwtDecode(token);\r\n                dispatch(setCurrentUser(decoded));\r\n                dispatch(getCartInfo());\r\n                history.goBack();\r\n            })\r\n            .catch(err => {\r\n                toast.error('Tài khoản hoặc mật khẩu không chính xác!', {\r\n                    position: \"bottom-center\",\r\n                    theme: 'dark',\r\n                    autoClose: 2000,\r\n                    hideProgressBar: false,\r\n                    closeOnClick: true,\r\n                    pauseOnHover: true,\r\n                    draggable: true,\r\n                    progress: undefined,\r\n                });\r\n                console.log(err);\r\n            })\r\n    }\r\n}\r\n\r\nexport const register = (data, history) => {\r\n    return dispatch => {\r\n        axios({\r\n            method: \"POST\",\r\n            data: JSON.stringify(data),\r\n            url: `${API_URL}/api/auth/register`,\r\n            headers: {\r\n                'content-type': 'application/json'\r\n            }\r\n        })\r\n            .then((res) => {\r\n                toast.success(res.data.message, {\r\n                    position: \"bottom-center\",\r\n                    autoClose: 1500,\r\n                    hideProgressBar: false,\r\n                    closeOnClick: true,\r\n                    pauseOnHover: true,\r\n                    draggable: true,\r\n                    progress: undefined,\r\n                });\r\n                history.push(\"/login\")\r\n            })\r\n            .catch((err) => {\r\n                if (err) {\r\n                    toast.error(err.response.data.message, {\r\n                        position: \"bottom-center\",\r\n                        theme: 'dark',\r\n                        autoClose: 2000,\r\n                        hideProgressBar: false,\r\n                        closeOnClick: true,\r\n                        pauseOnHover: true,\r\n                        draggable: true,\r\n                        progress: undefined,\r\n                    });\r\n                    dispatch(getErrors(err.response.data.message))\r\n                }\r\n            })\r\n    }\r\n}\r\n\r\nexport const updateInfo = (data) => {\r\n    return axios({\r\n        method: \"PUT\",\r\n        url: `${API_URL}/api/auth/update-info`,\r\n        headers: headers,\r\n        data: data\r\n    })\r\n}\r\n\r\nexport const updatePassword = (data) => {\r\n    return axios({\r\n        method: \"PUT\",\r\n        url: `${API_URL}/api/auth/update-password`,\r\n        headers: headers,\r\n        data: data\r\n    })\r\n}\r\n\r\nexport const logout = () => {\r\n    return dispatch => {\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"username\");\r\n        dispatch(setCurrentUser({}));\r\n        window.location.reload();\r\n        setHeader();\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}