{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from \"axios\";\nimport { useEffect, useState } from \"react\";\nimport { API_URL } from 'actions/constants/constants';\naxios.defaults.headers.common['token'] = process.env.REACT_APP_GHN_TOKEN;\nconst token = localStorage.getItem('token');\nasync function fetchCityOptions() {\n  let url = 'https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province';\n  const locations = await (await axios.get(url)).data.data;\n  return locations.map(item => {\n    return {\n      value: item.ProvinceID,\n      label: item.ProvinceName\n    };\n  });\n}\nasync function fetchDistrictOptions(ProvinceID) {\n  let url = `https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${ProvinceID}`;\n  const locations = await (await axios.get(url)).data.data;\n  return locations.map(item => {\n    return {\n      value: item.DistrictID,\n      label: item.DistrictName\n    };\n  });\n}\nasync function fetchWardOptions(DistrictID) {\n  let url = `https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${DistrictID}`;\n  const locations = await (await axios.get(url)).data.data;\n  return locations.map(item => {\n    return {\n      value: item.WardCode,\n      label: item.WardName\n    };\n  });\n}\nasync function fetchInitialData() {\n  const {\n    city_id,\n    district_id,\n    ward_id\n  } = (await axios.get(`${API_URL}/api/auth/info`, {\n    headers: {\n      Authorization: `Bearer ${token}`\n    }\n  })).data;\n  const [cities, districts, wards] = await Promise.all([fetchCityOptions(), fetchDistrictOptions(city_id), fetchWardOptions(district_id)]);\n  return {\n    cityOptions: cities,\n    districtOptions: districts,\n    wardOptions: wards,\n    selectedCity: cities.find(c => c.value === city_id),\n    selectedDistrict: districts.find(d => d.value === district_id),\n    selectedWard: wards.find(w => w.value === ward_id)\n  };\n}\nfunction useLocationForm() {\n  _s();\n  const [state, setState] = useState({\n    cityOptions: [],\n    districtOptions: [],\n    wardOptions: [],\n    selectedCity: null,\n    selectedDistrict: null,\n    selectedWard: null\n  });\n  const [shouldFetchInitialLocation, setShouldFetchInitialLocation] = useState(false);\n  const {\n    selectedCity,\n    selectedDistrict\n  } = state;\n  useEffect(() => {\n    (async function () {\n      const initialData = await fetchInitialData();\n      if (initialData.selectedCity) {\n        setShouldFetchInitialLocation(true);\n      } else {\n        setShouldFetchInitialLocation(false);\n      }\n    })();\n  }, []);\n  useEffect(() => {\n    (async function () {\n      if (shouldFetchInitialLocation) {\n        const initialData = await fetchInitialData();\n        setState(initialData);\n      } else {\n        const options = await (await axios.get('https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province')).data.data;\n        setState({\n          ...state,\n          cityOptions: options.sort((a, b) => a.ProvinceID - b.ProvinceID).map(item => {\n            return {\n              value: item.ProvinceID,\n              label: item.ProvinceName\n            };\n          })\n        });\n      }\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shouldFetchInitialLocation]);\n  useEffect(() => {\n    (async function () {\n      if (!selectedCity) return;\n      const options = await (await axios.get(`https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${selectedCity.value}`)).data.data;\n      setState({\n        ...state,\n        districtOptions: options.map(item => {\n          return {\n            value: item.DistrictID,\n            label: item.DistrictName\n          };\n        })\n      });\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedCity]);\n  useEffect(() => {\n    (async function () {\n      if (!selectedDistrict) return;\n      const options = await (await axios.get(`https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${selectedDistrict.value}`)).data.data;\n      setState({\n        ...state,\n        wardOptions: options.map(item => {\n          return {\n            value: item.WardCode,\n            label: item.WardName\n          };\n        })\n      });\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedDistrict]);\n  function onCitySelect(option) {\n    setState({\n      ...state,\n      districtOptions: [],\n      wardOptions: [],\n      selectedCity: option,\n      selectedDistrict: null,\n      selectedWard: null\n    });\n  }\n  function onDistrictSelect(option) {\n    setState({\n      ...state,\n      wardOptions: [],\n      selectedDistrict: option,\n      selectedWard: null\n    });\n  }\n  function onWardSelect(option) {\n    setState({\n      ...state,\n      selectedWard: option\n    });\n  }\n  return {\n    state,\n    onCitySelect,\n    onDistrictSelect,\n    onWardSelect\n  };\n}\n_s(useLocationForm, \"BePSlYZbduCi314hZ4K5O9ZNs84=\");\nexport default useLocationForm;","map":{"version":3,"names":["axios","useEffect","useState","API_URL","defaults","headers","common","process","env","REACT_APP_GHN_TOKEN","token","localStorage","getItem","fetchCityOptions","url","locations","get","data","map","item","value","ProvinceID","label","ProvinceName","fetchDistrictOptions","DistrictID","DistrictName","fetchWardOptions","WardCode","WardName","fetchInitialData","city_id","district_id","ward_id","Authorization","cities","districts","wards","Promise","all","cityOptions","districtOptions","wardOptions","selectedCity","find","c","selectedDistrict","d","selectedWard","w","useLocationForm","_s","state","setState","shouldFetchInitialLocation","setShouldFetchInitialLocation","initialData","options","sort","a","b","onCitySelect","option","onDistrictSelect","onWardSelect"],"sources":["D:/TutuFinal/tutuClient/src/hooks/useLocationForm.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { useEffect, useState } from \"react\";\r\nimport {API_URL} from 'actions/constants/constants'\r\naxios.defaults.headers.common['token'] = process.env.REACT_APP_GHN_TOKEN;\r\nconst token = localStorage.getItem('token');\r\nasync function fetchCityOptions() {\r\n    let url = 'https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province';\r\n    const locations = await (await axios.get(url)).data.data\r\n    return locations.map((item => {\r\n        return {\r\n            value: item.ProvinceID,\r\n            label: item.ProvinceName\r\n        }\r\n    }));\r\n}\r\n\r\nasync function fetchDistrictOptions(ProvinceID) {\r\n    let url = `https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${ProvinceID}`;\r\n    const locations = await (await axios.get(url)).data.data\r\n    return locations.map((item => {\r\n        return {\r\n            value: item.DistrictID,\r\n            label: item.DistrictName\r\n        }\r\n    }));\r\n}\r\n\r\nasync function fetchWardOptions(DistrictID) {\r\n    let url = `https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${DistrictID}`;\r\n    const locations = await (await axios.get(url)).data.data\r\n    return locations.map((item => {\r\n        return {\r\n            value: item.WardCode,\r\n            label: item.WardName\r\n        }\r\n    }));\r\n}\r\n\r\n\r\n\r\nasync function fetchInitialData() {\r\n    const { city_id, district_id, ward_id } = (await axios.get(`${API_URL}/api/auth/info`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n    })).data;\r\n    const [cities, districts, wards] = await Promise.all([\r\n        fetchCityOptions(),\r\n        fetchDistrictOptions(city_id),\r\n        fetchWardOptions(district_id),\r\n    ]);\r\n    return {\r\n        cityOptions: cities,\r\n        districtOptions: districts,\r\n        wardOptions: wards,\r\n        selectedCity: cities.find((c) => c.value === city_id),\r\n        selectedDistrict: districts.find((d) => d.value === district_id),\r\n        selectedWard: wards.find((w) => w.value === ward_id),\r\n    };\r\n}\r\n\r\n\r\nfunction useLocationForm() {\r\n    const [state, setState] = useState({\r\n        cityOptions: [],\r\n        districtOptions: [],\r\n        wardOptions: [],\r\n        selectedCity: null,\r\n        selectedDistrict: null,\r\n        selectedWard: null,\r\n    });\r\n    const [shouldFetchInitialLocation, setShouldFetchInitialLocation] = useState(false);\r\n\r\n    const { selectedCity, selectedDistrict } = state;\r\n\r\n    useEffect(() => {\r\n        (async function () {\r\n            const initialData = await fetchInitialData();\r\n            if(initialData.selectedCity) {\r\n                setShouldFetchInitialLocation(true);\r\n            } else {\r\n                setShouldFetchInitialLocation(false);\r\n            }\r\n            \r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        (async function () {\r\n            if (shouldFetchInitialLocation) {\r\n                const initialData = await fetchInitialData();\r\n                setState(initialData);\r\n            } else {\r\n                const options = await (await axios.get('https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province')).data.data;\r\n                setState({\r\n                    ...state, cityOptions: options.sort((a, b) => a.ProvinceID - b.ProvinceID).map((item) => {\r\n                        return {\r\n                            value: item.ProvinceID,\r\n                            label: item.ProvinceName\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        })();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [shouldFetchInitialLocation]);\r\n\r\n    useEffect(() => {\r\n        (async function () {\r\n            if (!selectedCity) return;\r\n            const options = await (await axios.get(`https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${selectedCity.value}`)).data.data\r\n            setState({\r\n                ...state, districtOptions: options.map((item) => {\r\n                    return {\r\n                        value: item.DistrictID,\r\n                        label: item.DistrictName\r\n                    }\r\n                })\r\n            })\r\n        })();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [selectedCity]);\r\n\r\n    useEffect(() => {\r\n        (async function () {\r\n            if (!selectedDistrict) return;\r\n            const options = await (await axios.get(`https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${selectedDistrict.value}`)).data.data\r\n            setState({\r\n                ...state, wardOptions: options.map((item) => {\r\n                    return {\r\n                        value: item.WardCode,\r\n                        label: item.WardName\r\n                    }\r\n                })\r\n            })\r\n        })()\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [selectedDistrict])\r\n\r\n    function onCitySelect(option) {\r\n        setState({\r\n            ...state,\r\n            districtOptions: [],\r\n            wardOptions: [],\r\n            selectedCity: option,\r\n            selectedDistrict: null,\r\n            selectedWard: null,\r\n        });\r\n    }\r\n\r\n    function onDistrictSelect(option) {\r\n        setState({\r\n            ...state,\r\n            wardOptions: [],\r\n            selectedDistrict: option,\r\n            selectedWard: null,\r\n        });\r\n    }\r\n\r\n    function onWardSelect(option) {\r\n        setState({ ...state, selectedWard: option });\r\n    }\r\n\r\n    return { state, onCitySelect, onDistrictSelect, onWardSelect };\r\n}\r\n\r\nexport default useLocationForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}